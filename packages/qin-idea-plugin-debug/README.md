# Qin IDEA Plugin

> IntelliJ IDEA æ’ä»¶ï¼Œä¸º Qin æ„å»ºå·¥å…·æä¾› IDE é›†æˆæ”¯æŒã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. æ ‘å½¢é¡¹ç›®ç®¡ç†ï¼ˆç±»ä¼¼ Gradleï¼‰
- **ğŸ“¦ é¡¹ç›®æ ‘**ï¼šè‡ªåŠ¨æ‰«æå¹¶æ˜¾ç¤ºæ‰€æœ‰ Qin é¡¹ç›®
- **ğŸ“ ä»»åŠ¡åˆ†ç»„**ï¼šsyncã€compileã€runã€buildã€clean
- **ğŸ“š ä¾èµ–å±•ç¤º**ï¼šæ˜¾ç¤ºé¡¹ç›®çš„æ‰€æœ‰ä¾èµ–
- **åŒå‡»æ‰§è¡Œ**ï¼šåŒå‡»ä»»åŠ¡èŠ‚ç‚¹ç«‹å³æ‰§è¡Œ
- **ğŸ”„ åˆ·æ–°æŒ‰é’®**ï¼šç‚¹å‡»å·¦ä¸Šè§’åˆ·æ–°å›¾æ ‡åŒæ­¥æ‰€æœ‰é¡¹ç›®

### 2. è‡ªåŠ¨ä¾èµ–åŒæ­¥
- **é¡¹ç›®æ‰“å¼€æ—¶è‡ªåŠ¨æ‰§è¡Œ `qin sync`**
- è‡ªåŠ¨å‘ç° Monorepo ä¸­çš„æ‰€æœ‰å­é¡¹ç›®
- ä¸ºæ¯ä¸ªå­é¡¹ç›®åŒæ­¥ä¾èµ–

### 3. IDEA é›†æˆ
- **è‡ªåŠ¨ç”Ÿæˆ `.idea/libraries/*.xml`**ï¼šè®© IDEA è¯†åˆ«é¡¹ç›®ä¾èµ–
- **é…ç½®ç¼–è¯‘è¾“å‡ºè·¯å¾„**ï¼šè‡ªåŠ¨è®¾ç½®ä¸º `build/classes`ï¼ˆä¸ qin ä¸€è‡´ï¼‰
- **æ›´æ–° `.iml` æ–‡ä»¶**ï¼šè‡ªåŠ¨æ·»åŠ åº“å¼•ç”¨

### 4. Monorepo æ”¯æŒ
- **æ™ºèƒ½æ‰«æç­–ç•¥**ï¼š
  1. ä» IDEA æ‰“å¼€çš„ç›®å½•å‘ä¸ŠæŸ¥æ‰¾ workspace root
  2. ä» workspace root å‘ä¸‹é€’å½’æ‰«ææ‰€æœ‰ `qin.config.json`
  3. åœ¨æ ‘å½¢ç•Œé¢ä¸­å±•ç¤ºæ‰€æœ‰é¡¹ç›®

## è®¾è®¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DebugStartup.java                     â”‚
â”‚                  (ProjectActivity å®ç°)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  1. é¡¹ç›®æ‰“å¼€æ—¶è§¦å‘                                        â”‚
â”‚     â†“                                                   â”‚
â”‚  2. findWorkspaceRoot() - å‘ä¸ŠæŸ¥æ‰¾ workspace root        â”‚
â”‚     â†“                                                   â”‚
â”‚  3. scanForQinProjects() - å‘ä¸‹æ‰«ææ‰€æœ‰ qin.config.json   â”‚
â”‚     â†“                                                   â”‚
â”‚  4. runQinSync() - ä¸ºæ¯ä¸ªé¡¹ç›®æ‰§è¡Œ qin sync               â”‚
â”‚     â†“                                                   â”‚
â”‚  5. VirtualFileManager.refresh() - åˆ·æ–° IDEA é¡¹ç›®æ¨¡å‹    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç±»è¯´æ˜

| ç±» | åŠŸèƒ½ |
|---|---|
| `DebugStartup` | é¡¹ç›®å¯åŠ¨ç›‘å¬å™¨ï¼Œè‡ªåŠ¨æ£€æµ‹ Qin é¡¹ç›®å¹¶æ‰§è¡Œ sync |
| `QinToolWindowFactory` | Qin å·¥å…·çª—å£é¢æ¿ï¼Œæä¾› Sync/Compile/Run æŒ‰é’® |
| `QinLogger` | æ—¥å¿—è®°å½•å™¨ï¼ŒæŒ‰é¡¹ç›®å’Œæ—¶é—´ç»„ç»‡æ—¥å¿—æ–‡ä»¶ |

### æ‰«æç­–ç•¥å®ç°

```java
// 1. å‘ä¸ŠæŸ¥æ‰¾ workspace rootï¼ˆå–æœ€é¡¶å±‚ï¼‰
private Path findWorkspaceRoot(Path startDir) {
    Path current = startDir;
    Path topMost = startDir;
    
    while (current != null) {
        // æ ‡å¿—ï¼š.idea, .vscode, .git, qin.config.json
        if (isProjectRoot(current)) {
            topMost = current; // ç»§ç»­å‘ä¸Šï¼Œå–æœ€é¡¶å±‚
        }
        current = current.getParent();
    }
    return topMost;
}

// 2. å‘ä¸‹é€’å½’æ‰«æï¼ˆæœ€å¤š 5 å±‚æ·±åº¦ï¼‰
private void scanForQinProjects(Path dir, List<Path> projects, int depth, int maxDepth) {
    if (depth >= maxDepth) return;
    
    for (Path subDir : Files.list(dir)) {
        if (Files.exists(subDir.resolve("qin.config.json"))) {
            projects.add(subDir);
        }
        scanForQinProjects(subDir, projects, depth + 1, maxDepth);
    }
}
```

## å®‰è£…

1. åœ¨ IDEA ä¸­æ‰“å¼€ **Settings â†’ Plugins â†’ âš™ï¸ â†’ Install Plugin from Disk**
2. é€‰æ‹© `build/distributions/qin-idea-plugin-debug-x.x.x.zip`
3. é‡å¯ IDEA

## æ„å»º

```bash
cd packages/qin-idea-plugin-debug
./gradlew buildPlugin
```

è¾“å‡ºï¼š`build/distributions/qin-idea-plugin-debug-x.x.x.zip`

## é…ç½®

æ’ä»¶ä¼šè‡ªåŠ¨æ£€æµ‹åŒ…å« `qin.config.json` çš„é¡¹ç›®ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### å¸¸é‡é…ç½®

| å¸¸é‡ | å€¼ | è¯´æ˜ |
|---|---|---|
| `CONFIG_FILE` | `qin.config.json` | é…ç½®æ–‡ä»¶å |
| `EXCLUDED_DIRS` | `node_modules, .git, build, ...` | æ‰«ææ—¶æ’é™¤çš„ç›®å½• |
| æ‰«ææ·±åº¦ | 5 å±‚ | å‘ä¸‹é€’å½’æ‰«æçš„æœ€å¤§æ·±åº¦ |

## æ—¥å¿—

æ—¥å¿—æ–‡ä»¶ä¿å­˜åœ¨ï¼š`~/.qin/logs/{é¡¹ç›®å}/{æ—¥æœŸ}.log`

## ç‰ˆæœ¬å†å²

### 0.0.9 (å½“å‰)
- **æ ‘å½¢ç•Œé¢**ï¼šå®Œå…¨é‡å†™å·¥å…·çª—å£ï¼Œç±»ä¼¼ Gradle ç•Œé¢
- **é¡¹ç›®æ ‘å±•ç¤º**ï¼šè‡ªåŠ¨æ‰«æå¹¶æ˜¾ç¤ºæ‰€æœ‰ Qin é¡¹ç›®
- **ä»»åŠ¡ç®¡ç†**ï¼šæ¯ä¸ªé¡¹ç›®ä¸‹æ˜¾ç¤º Tasks å’Œ Dependencies
- **åŒå‡»æ‰§è¡Œ**ï¼šåŒå‡»ä»»åŠ¡èŠ‚ç‚¹ç›´æ¥æ‰§è¡Œå‘½ä»¤
- **åˆ·æ–°æŒ‰é’®**ï¼šå·¦ä¸Šè§’åˆ·æ–°å›¾æ ‡åŒæ­¥æ‰€æœ‰é¡¹ç›®

### 0.0.8
- ä¿®å¤ Monorepo å·¥å…·çª—å£æ˜¾ç¤º
- åˆ—å‡ºæ‰€æœ‰å‘ç°çš„å­é¡¹ç›®

### 0.0.7
- å¢å¼º Monorepo æ”¯æŒï¼šå‘ä¸Šæ‰¾ workspace rootï¼Œå‘ä¸‹æ‰«ææ‰€æœ‰å­é¡¹ç›®
- å¸¸é‡åŒ–é…ç½®æ–‡ä»¶å

### 0.0.6
- è‡ªåŠ¨åŒæ­¥ä¾èµ–
- è‡ªåŠ¨ç”Ÿæˆ IDEA åº“é…ç½®
- é…ç½®ç¼–è¯‘è¾“å‡ºè·¯å¾„ä¸º `build/classes`

### 0.0.5
- åˆå§‹ç‰ˆæœ¬
- Qin å·¥å…·çª—å£é¢æ¿
